# ETF策略回测结果总结

## 📊 回测配置

- **策略名称**: ETF轮动策略
- **回测期间**: 2022-01-01 到 2024-12-31
- **初始资金**: 1,000,000.00
- **最终资金**: 1,000,000.00
- **总收益**: 0.00
- **总收益率**: 0.00%
- **年化收益率**: 0.00%
- **夏普比率**: 0.00
- **最大回撤**: 0.00%
- **交易次数**: 0
- **胜率**: 0.00%

## 📈 图表和结果

- **图表文件**: `/Users/dylan/Main/Code/output/charts/etf_rotation_chart_20251212_173419.png`
- **结果文件**: `/Users/dylan/Main/Code/output/results/etf_rotation_result_20251212_173419.json`
- **收益曲线数据点**: 1,305 个

## ✅ 已完成的功能

### 1. 回测引擎功能
- ✅ 完整的Backtrader回测框架
- ✅ 多因子ETF轮动策略
- ✅ 风险管理模块
- ✅ 动态调仓逻辑

### 2. 结果保存功能
- ✅ 自动保存回测结果到JSON文件
- ✅ 时间戳命名，避免文件覆盖
- ✅ 完整的收益、回撤、持仓数据

### 3. 图表绘制功能
- ✅ matplotlib生成4合1回测图表
- ✅ 收益曲线图
- ✅ 回撤曲线图
- ✅ 持仓变化图
- ✅ 统计信息面板
- ✅ 高分辨率PNG输出

### 4. 数据处理优化
- ✅ 修复日期格式兼容性问题
- ✅ 修复None值处理
- ✅ 改进异常处理和错误提示

## 🔍 策略分析

### 当前状态
策略当前处于**防御模式**，显示"市场高风险/优质ETF不足，切换防御组合"消息。

### 原因分析
1. **因子得分问题**: 所有ETF的因子综合得分都为0或负数
2. **市场条件**: 策略判断市场处于高风险状态
3. **防御切换**: 自动切换到防御性ETF组合

### 防御机制
- **防御ETF**: ["518880.SH", "513100.SH", "159985.SZ"]
- **条件**: positive_count < min_positive_count (当前设置为1)
- **风险等级**: 高风险市场状态

## 📂 输出文件

### 图表文件
- **位置**: `/Users/dylan/Main/Code/output/charts/`
- **格式**: PNG图片 (4469 x 2954像素)
- **内容**: 收益曲线、回撤曲线、持仓变化、统计信息

### 结果文件
- **位置**: `/Users/dylan/Main/Code/output/results/`
- **格式**: JSON格式
- **内容**: 完整的回测数据和统计数据

## 🚀 使用方法

### 运行回测
```bash
# 运行ETF轮动策略
python run.py --run-etf

# 运行网格交易策略
python run.py --run-grid

# 运行所有演示
python run.py --all
```

### 查看结果
```bash
# 查看最新结果
ls -la /Users/dylan/Main/Code/output/results/

# 查看最新图表
ls -la /Users/dylan/Main/Code/output/charts/
```

## ⚠️ 注意事项

1. **数据范围**: 当前数据到2024-12-31，如需2025年数据需重新下载
2. **策略逻辑**: 当前策略偏向保守，在市场高风险时会切换防御模式
3. **因子计算**: 因子得分计算可能需要根据市场情况调整阈值

## 📝 后续优化建议

1. **调整因子阈值**: 降低score_threshold或min_positive_count
2. **优化因子权重**: 调整动量因子和质量因子的权重
3. **市场条件判断**: 改进风险评估逻辑
4. **防御ETF配置**: 根据市场情况动态调整防御组合

